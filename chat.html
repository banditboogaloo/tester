<html class="smella"><head></head><body>
<title>(brought to you by wdye)</title>
<style>
body {
	background-color: black;
	font-family: "Bahnschrift", "Bahnschrift", cursive;
}

p {
	color: white;
}

a {
	color: white;
}

h2 {
	color : white;
}

button {
        border: 2px solid white; 
        padding: 5px; 
        text-decoration: none;
		background-color: black;
		color: white;
		font-size: 17;
}

label {
	color: white;
}

li {
    list-style-type: none;
}

ul {
    list-style-type: none;
}

#guestListItems li {
      color: white;
	  text-decoration: none;
}
</style>
<center>
<h2>The Mandrill Chat</h2>
<hr>
<script>
// Function to set a cookie with a specified name and value
function setCookie(name, value, days) {
    const date = new Date();
    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
    const expires = "expires=" + date.toUTCString();
    document.cookie = name + "=" + value + ";" + expires + ";path=/";
}

// Function to get the value of a cookie by its name
function getCookie(name) {
    const decodedCookie = decodeURIComponent(document.cookie);
    const cookies = decodedCookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.startsWith(name + '=')) {
            return cookie.substring(name.length + 1);
        }
    }
    return "";
}

// Function to check if the username is locked based on the presence of a cookie
function isUsernameLocked() {
    return !!getCookie('usernameLocked');
}

function addGuest() {
    const nameInput = document.getElementById('guestName');
    const usernameInput = document.getElementById('guestUsername');
    const name = nameInput.value;
    const username = usernameInput.value;

    console.log("Name:", name);
    console.log("Username:", username);

    if (!name || !username) {
        alert('Fill in both the fields, dummy.');
        return;
    }

    fetch('https://guest.fiallaspares.com/api/addGuest', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `name=${encodeURIComponent(name)}&username=${encodeURIComponent(username)}`,
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(`Message sent with ID: ${data.guestId}`);
            nameInput.value = '';
            nameInput.focus();
            setCookie('usernameLocked', 'true', 30); // Set a cookie to lock the username for 30 days
        } else {
            alert('Failed to add guest.');
        }
    })
    .catch(error => {
        console.error('Error adding guest:', error.message);
        alert('Failed to add guest.');
    });
}

document.addEventListener('DOMContentLoaded', function () {
    const usernameInput = document.getElementById('guestUsername');
    if (isUsernameLocked()) {
        usernameInput.disabled = true; // Disable the username input if it's locked
    }
});
</script>
  <label for="guestUsername">usanem:</label>
<input type="text" id="guestUsername" name="guestUsername"><br><br>
  <label for="guestName">message herez</label>
            <input type="text" id="guestName" name="guestName">
            <button onclick="addGuest()">Send</button>


      <div id="guestList">
        <h2>epik bandit messagez</h2>
        <ul id="guestListItems"> </ul>
      </div>
    
  

  <script>
function getGuestList() {
  fetch('https://guest.fiallaspares.com/api/getGuests')
    .then(response => response.json())
    .then(data => {
      const guestListItems = document.getElementById('guestListItems');
      guestListItems.innerHTML = '';

      // Reverse the order of the array to display newest guests first
      data.reverse().forEach(guest => {
        const listItem = document.createElement('li');
        listItem.textContent = `${guest.name} (${guest.username})`; // Include both name and username
        guestListItems.appendChild(listItem);
      });
    })
    .catch(error => {
      console.error('Error fetching guest list:', error.message);
    });
}

// Fetch new messages every 1 seconds B)
function fetchNewMessages() {
  getGuestList();
  setTimeout(fetchNewMessages, 1000);
}

document.addEventListener('DOMContentLoaded', function () {
  getGuestList();
  fetchNewMessages(); 
});
  </script>

</center></body></html>
