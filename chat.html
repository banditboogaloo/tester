<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Mandrill Chat</title>
    <link rel="icon" type="image/x-icon" href="https://banditboogaloo.com/art.jpg">
    <meta content="JBMod Servers (NEW UI)" property="og:title" />
    <meta content="goostbook!!!" property="og:description" />
    <meta content="https://thatwardrobeguy.neocities.org/endorsed.png" property="og:image" />
    <meta content="#b303d0" data-react-helmet="true" name="theme-color" />
    <title>The Mandrill Chat</title>

<script>
 fetch('/api/serverList', {
        headers: {
            'X-Requested-From': 'index.html'
        },
    });
</script>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
 <style>
  body {
    background-image: url('maze.gif');
    color: #333;
    font-family: Arial, sans-serif;
    background-size: cover;
    margin: 0;
    padding: 20px;
    background-color: #333; /* Updated background color to match existing styles */
  }

  .container {
    width: 80%;
    margin: auto;
    border: none;
    border-radius: 10px;
    box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.2);
    font-family: 'Bahnschrift', sans-serif;
    padding: 20px;
    background-color: #888;
  }

  .container h1 {
    color: purple;
  }

  ul {
    list-style-type: none;
  }

  li {
    list-style-type: none;
  }

  a {
    color: #ffffff;
    text-decoration: none; /* Added text-decoration to match existing styles */
  }

  a:hover {
    text-decoration: underline; /* Added text-decoration to match existing styles */
  }

  hr {
    margin-top: 20px;
    margin-bottom: 20px;
    border: 0;
    border-top: 1px solid #ccc;
  }

  body.dark-mode {
    background-color: #efefef;
    color: #000;
  }

  .container.dark-mode {
    background-color: white;
  }

  .dark-mode-toggle {
    font-size: 15px;
    cursor: pointer;
    margin: 10px;
    background: none;
    border: none;
    outline: none;
  }

  .dark-mode-toggle.moon::before {
    content: '\2600';
    font-size: 17px;
    color: #FFFF00;
  }

  .dark-mode-toggle.sun::before {
    content: '\1F319';
    color: #000000;
  }

  body.dark-mode a {
    color: #000;
  }

  .content {
    max-width: 800px;
    margin: 0 auto;
    background-color: rgba(255, 255, 255, 0.65);
    padding: 20px;
  }

  h1 {
    color: #555;
    font-size: 24px;
    margin-bottom: 20px;
  }

  p {
    margin-bottom: 10px;
  }

  a {
    color: #007bff;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }
</style>

</head>

<body>
            <nav id="navbar">
<script>
// Function to set a cookie with a specified name and value
function setCookie(name, value, days) {
    const date = new Date();
    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
    const expires = "expires=" + date.toUTCString();
    document.cookie = name + "=" + value + ";" + expires + ";path=/";
}

// Function to get the value of a cookie by its name
function getCookie(name) {
    const decodedCookie = decodeURIComponent(document.cookie);
    const cookies = decodedCookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.startsWith(name + '=')) {
            return cookie.substring(name.length + 1);
        }
    }
    return "";
}

// Function to check if the username is locked based on the presence of a cookie
function isUsernameLocked() {
    return !!getCookie('usernameLocked');
}

function addGuest() {
    const nameInput = document.getElementById('guestName');
    const usernameInput = document.getElementById('guestUsername');
    const name = nameInput.value;
    const username = usernameInput.value;

    console.log("Name:", name);
    console.log("Username:", username);

    if (!name || !username) {
        alert('Please fill in both name and username fields!');
        return;
    }

    fetch('https://guest.fiallaspares.com/api/addGuest', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `name=${encodeURIComponent(name)}&username=${encodeURIComponent(username)}`,
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(`Message sent with ID: ${data.guestId}`);
            nameInput.value = '';
            nameInput.focus();
            setCookie('usernameLocked', 'true', 30); // Set a cookie to lock the username for 30 days
            setCookie('lockedUsernameValue', username, 30); // Save the locked username in a cookie
        } else {
            alert('Failed to add guest.');
        }
    })
    .catch(error => {
        console.error('Error adding guest:', error.message);
        alert('Failed to add guest.');
    });
}

document.addEventListener('DOMContentLoaded', function () {
    const usernameInput = document.getElementById('guestUsername');
    if (isUsernameLocked()) {
        usernameInput.value = getCookie('lockedUsernameValue'); // Restore the locked username
        usernameInput.disabled = true; // Disable the username input if it's locked
    }
});
</script>
</head>

<body>

    <div class="container">
        <div id="container">
            <h1>The Mandrill Chat</h1>
			<h2>Brought to you by WDYE (reload to see new messages)</h2>
            <hr>
            <nav id="navbar">
            </nav>
			  <label for="guestUsername">Username:</label>
<input type="text" id="guestUsername" name="guestUsername"><br><br>
            <label for="guestName">Message</label>
            <input type="text" id="guestName" name="guestName">
            <button onclick="addGuest()">Send</button>


      <div id="guestList">
        <h2>Messages</h2>
        <ul id="guestListItems"></ul>
      </div>
    </div>
  </div>

  <audio id="dingSound">
  <source src="https://banditboogaloo.com/ding.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>
  <script>
let previousMessageCount = 0;

function getGuestList() {
  fetch('https://guest.fiallaspares.com/api/getGuests')
    .then(response => response.json())
    .then(data => {
      const guestListItems = document.getElementById('guestListItems');
      guestListItems.innerHTML = '';

      // Reverse the order of the array to display newest guests first
      data.reverse().forEach(guest => {
        const listItem = document.createElement('li');
        listItem.textContent = `${guest.name} (${guest.username})`; // Include both name and username
        guestListItems.appendChild(listItem);
      });

      const newMessageCount = data.length;
      if (newMessageCount > previousMessageCount) {
        playDingSound(); // Play ding sound when new messages arrive
      }
      previousMessageCount = newMessageCount;
    })
    .catch(error => {
      console.error('Error fetching guest list:', error.message);
    });
}

function playDingSound() {
  const dingSound = document.getElementById('dingSound');
  dingSound.play();
}

// Fetch new messages every 1 second
function fetchNewMessages() {
  getGuestList();
  setTimeout(fetchNewMessages, 1000);
}

document.addEventListener('DOMContentLoaded', function () {
  getGuestList();
  fetchNewMessages();
});
  </script>
        </div>
    </div>
</body>

</html>
